import pandas as pd
import geopandas as gpd
import matplotlib.pyplot as plt

# 1. Cargar el mapa del INEGI (Asegúrate de tener 08a.shp, .shx, .dbf en la carpeta)
# Geopandas lee el .shp y busca automáticamente los otros archivos
mapa_ageb = gpd.read_file("08a.shp")

# 2. Cargar los datos de NSE preparados (el CSV que te acabo de generar)
# Importante: asegurar que CVEGEO se lea como texto (string) para que no pierda ceros
datos_nse = pd.read_csv("NSE_AGEB_Chihuahua_Ready.csv", dtype={'CVEGEO': str})

# 3. La Fusión (Merge)
# Unimos el mapa con los datos usando la columna común 'CVEGEO'
mapa_final = mapa_ageb.merge(datos_nse, on="CVEGEO", how="left")

# Verificación rápida
print(f"Total AGEBs en el mapa: {len(mapa_ageb)}")
print(f"AGEBs con datos de NSE encontrados: {len(mapa_final[mapa_final['NIVEL PREDOMINANTE'].notna()])}")

# 4. Visualización
fig, ax = plt.subplots(figsize=(15, 15))

# Pintamos el mapa coloreando por 'NIVEL PREDOMINANTE'
mapa_final.plot(column='NIVEL PREDOMINANTE', 
                cmap='RdYlGn_r',    # Paleta de color (Rojo a Verde invertido, ajusta a tu gusto)
                legend=True, 
                linewidth=0.1, 
                edgecolor='grey',
                missing_kwds={'color': 'lightgrey'}, # Color para zonas sin dato
                ax=ax)

ax.set_title("Nivel Socioeconómico Predominante por AGEB - Chihuahua", fontsize=15)
ax.set_axis_off() # Ocultar ejes de coordenadas

plt.show()